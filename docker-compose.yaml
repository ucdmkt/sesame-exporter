# Sample docker-compose.yml for sesame-exporter and its Prometheus scraping
version: "3.8"
services:
    sesame-exporter:
        image: python:3.11-slim
        volumes:
            - .:/usr/src/app
        working_dir: /usr/src/app
        environment:
            - SESAME_WEB_API_KEY
        command:
            - sh
            - -c
            - /usr/src/app/entrypoint.sh --config /usr/src/app/config.yaml
        restart: unless-stopped

    prometheus:
        image: prom/prometheus:v3.3.0
        volumes:
            - ./prometheus.yaml:/etc/prometheus/prometheus.yaml:ro
        ports:
            - 9090:9090
        command:
            - --config.file=/etc/prometheus/prometheus.yaml
            - --storage.tsdb.path=/prometheus
            - --web.console.libraries=/usr/share/prometheus/console_libraries
            - --web.console.templates=/usr/share/prometheus/consoles
        restart: unless-stopped
